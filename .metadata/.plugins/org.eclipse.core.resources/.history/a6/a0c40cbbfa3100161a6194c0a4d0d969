package com.liuyihui.springdemo.model01;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.URL;
import java.net.URLConnection;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;

import org.apache.commons.codec.binary.Base64;
import org.apache.commons.httpclient.HttpClient;
import org.apache.commons.httpclient.HttpException;
import org.apache.commons.httpclient.HttpMethod;
import org.apache.commons.httpclient.methods.GetMethod;
import org.junit.Test;

public class WeatherConsumer {
	
	private String baseUrlStr="http://open.weather.com.cn/data/";
	private String publicKey="http://open.weather.com.cn/data/?areaid=101190101&type=index&date=201511130000&appid=382627ecb7964497";
	private String privateKey="yunge_webapi_data";
	
	
	@Test
	public void baseJavaNet() throws IOException, InvalidKeyException, NoSuchAlgorithmException{
		//加密生成密key并base64编码
		String base64ResultStr = Base64.encodeBase64String(HMACSHA1.encrypt(publicKey.getBytes(), privateKey.getBytes()));
		System.out.println("生成密key:"+base64ResultStr);// test for deleted
		
		//url拼接密key
		URL url=new URL(publicKey+"&key="+base64ResultStr);
		System.out.println("完整url："+url);
		
		URLConnection uc = url.openConnection();
		uc.connect();
		
		InputStream is = uc.getInputStream();
		
		BufferedReader br = new BufferedReader(new InputStreamReader(is));
		
		String line;
		while ((line = br.readLine())!=null){
			System.out.println(line);
		}
		br.close();
		is.close();
		
		
	}
	@Test
	public void testBase64() throws InvalidKeyException, NoSuchAlgorithmException{
		
		String base64Result = Base64.encodeBase64String(HMACSHA1.encrypt(publicKey.getBytes(), privateKey.getBytes()));
		System.out.println(base64Result);
	}
	@Test
	public void baseHttpClient() throws HttpException, IOException{
		//加密生成密key并base64编码
				String base64ResultStr = Base64.encodeBase64String(HMACSHA1.encrypt(publicKey.getBytes(), privateKey.getBytes()));
		String url = publicKey+"&key="+base64ResultStr;
		
		HttpClient httpClient = new HttpClient();
		
		HttpMethod method =  new GetMethod(publicKey);
		
		httpClient.executeMethod(method);
		
		//打印服务器返回的状态
		System.out.println(method.getStatusCode());
		
		//打印返回的信息
		System.out.println(method.getResponseBodyAsString());
		
		//释放连接
		method.releaseConnection();
		
	}
	

	public static void main(String[] args) {
	}
}
